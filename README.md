# 📸 PictureRename - 画像ファイル名変更システム

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://python.org)
[![Platform](https://img.shields.io/badge/Platform-macOS-lightgrey.svg)](https://www.apple.com/macos/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

Mac環境で動作する、画像ファイル名の一括変更システムです。フォルダ内の画像を順次表示し、各種情報を入力してファイル名を規則的に変更します。

![Screenshot](https://via.placeholder.com/800x500/3b82f6/ffffff?text=PictureRename+System)

## ✨ 特徴

- 🎨 **モダンなUI**: 美しく直感的なグラフィカルインターフェース
- 📊 **二階層素材選択**: 素材区分→素材名の階層型ドロップダウン
- 📜 **スクロール対応**: 入力欄のスクロール機能で操作性向上
- 💾 **データ保持**: 部品名・重量を写真間で自動保持
- 🔢 **自動連番**: ファイル名に自動的に連番を付与
- 🖼️ **多形式対応**: JPG, PNG, HEIC形式の画像をサポート
- 🚀 **高速処理**: 効率的な一括リネーム機能
- ⚡ **リアルタイムプレビュー**: 800x600pxでの画像プレビュー表示
- 🔄 **重複チェック**: 同名ファイル検出機能
- ⌨️ **キーボードショートカット**: 効率的な操作をサポート

## 📋 機能

- **対応画像形式**: JPG, PNG, HEIC, TIFF, BMP, GIF
- **Excel読み込み**: 素材マスター・加工方法マスターファイルの動的列検索
- **画像プレビュー**: 最大800x600pxでの画像表示（アスペクト比維持）
- **ファイル名規則**: `番号_部品名_重量_単位_素材ID_加工ID_写真区分_特記事項.拡張子`
- **階層化素材選択**: 素材区分選択→素材名選択の二段階方式
- **入力検証**: 全項目入力時のみ処理実行可能
- **スクロールUI**: 入力欄が多くても快適に操作可能
- **データ保持**: 連続作業時の部品名・重量保持機能

## 必要要件

- **OS**: macOS
- **Python**: 3.8以上
- **依存ライブラリ**: `requirements.txt` を参照

## インストール

1. **リポジトリをクローン**:
```bash
git clone <repository-url>
cd ImageRenamer
```

2. **依存ライブラリをインストール**:
```bash
pip install -r requirements.txt
```

## 使用方法

### 1. アプリケーション起動

```bash
python main.py
```

### 2. 初期設定

1. **素材マスター.xlsx**を読み込み（ファイルメニュー → 素材マスターを読み込み）
2. **加工方法マスター.xlsx**を読み込み（ファイルメニュー → 加工方法マスターを読み込み）
3. **画像フォルダ**を選択（ファイルメニュー → 画像フォルダを選択）

### 3. ファイル名変更

1. 左側の入力パネルに各項目を入力（スクロール可能）
   - **部品名**: 自由テキスト（必須）- 写真間で自動保持
   - **重量**: 半角英数字のみ（必須）- 写真間で自動保持
   - **単位**: kg / g から選択
   - **素材区分**: Excelファイルから読み込まれた区分を選択（必須）
   - **素材名**: 素材区分選択後に表示される素材名を選択（必須）
   - **加工方法**: Excelファイルから読み込まれた選択肢（必須）
   - **写真区分**: 部品写真(P) / 素材込み(M) から選択（必須）
   - **特記事項の有無**: なし(0) / ある(1) から選択（必須）

2. 全項目入力後、「適用&次へ」ボタンをクリック
3. 自動的に連番が付与され、次の画像に自動遷移
4. 部品名・重量は自動的に保持され、効率的な連続作業が可能

### 4. UI操作

#### スクロール操作
- **マウスホイール**: 入力パネル上でスクロール
- **矢印キー**: ↑↓でスクロール
- **Page Up/Down**: 大きくスクロール
- **自動スクロール**: 入力フィールドクリック時に自動的に表示

#### キーボードショートカット
- **Enter**: 適用&次へ（全項目入力時のみ）
- **←→**: 前の画像/次の画像へ移動

#### データ管理
- **部品名・重量クリア**: メニュー → ファイル → 部品名・重量をクリア

## 📊 Excelファイル形式

### 素材マスター.xlsx
**重要**: ヘッダー行から列を動的に検索するため、列の順序は任意です。

必須列:
- **素材ID**: 素材の一意識別子
- **素材区分**: 素材の分類（木材、金属、樹脂など）
- **素材名**: 具体的な素材名（ヒノキ、スギ、鉄、アルミなど）

例:
```
素材ID    素材区分    素材名        説明
M001     木材       ヒノキ        軽量で香りが良い
M002     木材       スギ          一般的な建材
M003     金属       鉄           重量のある金属
M004     金属       アルミ        軽量金属
M005     樹脂       PET          透明プラスチック
```

### 加工方法マスター.xlsx
**重要**: ヘッダー行から列を動的に検索するため、列の順序は任意です。

必須列:
- **加工ID**: 加工方法の一意識別子
- **加工方法名**: 加工方法の名称

例:
```
加工ID    加工方法名     説明
K001     切削          機械加工
K002     曲げ          プレス加工
K003     溶接          接合加工
```

### 二階層選択の仕組み
1. **素材区分選択**: 「木材」「金属」「樹脂」から選択
2. **素材名選択**: 選択した区分に属する素材名が自動表示
   - 木材選択 → ヒノキ、スギが表示
   - 金属選択 → 鉄、アルミが表示

### 生成されるファイル名の例
```
1_部品A_10.5_kg_M001_K001_P_0.jpg
└┬┘└─┬─┘└┬┘└┬┘└─┬─┘└─┬─┘└┬┘└┬┘
 │   │   │ │  │    │   │ │
 │   │   │ │  │    │   │ └── 特記事項（0=なし, 1=あり）
 │   │   │ │  │    │   └─── 写真区分（P=部品写真, M=素材込み）
 │   │   │ │  │    └─── 加工方法ID
 │   │   │ │  └─── 素材ID
 │   │   │ └─── 単位
 │   │   └─── 重量
 │   └─── 部品名
 └─── 自動連番（1, 2, 3...）
```

## 📁 プロジェクト構造

```
PictureRename/
├── main.py              # メインアプリケーション
├── requirements.txt     # 依存関係
├── README.md           # このファイル
├── CONTRIBUTING.md     # 貢献ガイドライン
├── LICENSE             # ライセンス
├── 起動方法.txt         # 起動手順
├── gui/
│   ├── __init__.py
│   ├── main_window.py   # メインウィンドウ（スクロール機能付き）
│   ├── image_viewer.py  # 画像表示部分
│   └── input_panel.py   # 入力パネル部分（二階層ドロップダウン）
└── utils/
    ├── __init__.py
    ├── file_handler.py  # ファイル操作（自動連番機能）
    ├── excel_reader.py  # Excel読み込み（動的列検索）
    └── image_processor.py # 画像処理
```

## macOSアプリ化

PyInstallerを使用してmacOSアプリケーション（.app）を作成できます：

```bash
# 基本的なアプリ作成
pyinstaller --onefile --windowed main.py

# アイコン付きでアプリ作成（アイコンファイルがある場合）
pyinstaller --onefile --windowed --icon=icon.icns main.py
```

## 🔧 トラブルシューティング

### HEIC画像が表示されない
- `pillow-heif`が正しくインストールされているか確認
- macOSの画像フォーマット設定を確認

### Excel読み込みでエラーが発生
- Excelファイルが.xlsx形式であることを確認
- **必須列**が正しく存在するか確認:
  - 素材マスター: 「素材ID」「素材区分」「素材名」
  - 加工方法マスター: 「加工ID」「加工方法名」
- ファイルが他のアプリケーションで開かれていないか確認
- ヘッダー行（1行目）に正確な列名が入力されているか確認

### 素材名が選択できない
- 先に**素材区分**を選択してください
- 素材区分を選択すると、素材名のドロップダウンが活性化されます

### 重量入力で文字が入力できない
- 半角英数字のみ入力可能です
- 日本語入力がオンになっていないか確認

### 入力欄が見えない・操作しにくい
- **スクロール機能**を使用してください:
  - マウスホイールでスクロール
  - 矢印キー（↑↓）でスクロール
  - 入力フィールドをクリックすると自動スクロール

### 部品名・重量をクリアしたい
- メニューから「ファイル」→「部品名・重量をクリア」を選択

## ライセンス

このプロジェクトはMITライセンスの下でライセンスされています。

## 🚀 最新の更新情報

### v2.0.0 - 2024年10月
- ✅ **素材入力の二階層化**: 素材区分→素材名の階層型選択
- ✅ **スクロール対応UI**: 入力欄のスクロール機能で操作性向上
- ✅ **データ保持機能**: 部品名・重量を写真間で自動保持
- ✅ **自動連番機能**: ファイル名に1, 2, 3...の連番を自動付与
- ✅ **動的列検索**: Excelファイルのヘッダー行から列を自動検索
- ✅ **UI改善**: 写真区分・特記事項の表示をより分かりやすく改善

## 💻 開発情報

- **言語**: Python 3.8+
- **GUIフレームワーク**: Tkinter（Canvas + Scrollbar）
- **画像処理**: Pillow, pillow-heif
- **Excel処理**: openpyxl（動的列検索対応）
- **バージョン**: 2.0.0
- **対応OS**: macOS
- **アーキテクチャ**: MVC パターン

## 🤝 貢献

プロジェクトへの貢献を歓迎します！詳細は [CONTRIBUTING.md](CONTRIBUTING.md) をご覧ください。

## 📝 更新履歴

### v2.0.0 (2024-10-16)
- 素材入力機能を二階層ドロップダウンに改修
- スクロール可能な入力パネルを実装
- 部品名・重量のデータ保持機能を追加
- 自動連番機能を実装
- UIの視認性と操作性を大幅改善

### v1.0.0 (初期リリース)
- 基本的なファイルリネーム機能
- Excel マスターファイル連携
- 画像プレビュー機能